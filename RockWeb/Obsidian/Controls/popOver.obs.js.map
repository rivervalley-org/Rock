{"version":3,"file":"popOver.obs.js","sources":["../../../Framework/Controls/popOver.obs"],"sourcesContent":["<!-- Copyright by the Spark Development Network; Licensed under the Rock Community License -->\r\n<template>\r\n    <slot name=\"activator\" ref=\"activatorEl\" />\r\n    <div :class=\"['popover fade', placement]\" role=\"tooltip\" ref=\"popOverEl\" :id=\"popOverId\" :style=\"popOverStyle\">\r\n        <div class=\"arrow\"></div>\r\n        <h3 class=\"popover-title\" style=\"display: none;\"></h3>\r\n        <div class=\"popover-content\">\r\n            <slot name=\"popOverContent\" />\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n    import { nextTick, PropType, ref, watch } from \"vue\";\r\n    import { newGuid } from \"@Obsidian/Utility/guid\";\r\n\r\n    const props = defineProps({\r\n        /** A v-model indicating/controlling when to show the popover */\r\n        isVisible: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        /** Which side should the popOver appear on? */\r\n        placement: {\r\n            type: String as PropType<\"top\" | \"right\" | \"bottom\" | \"left\">,\r\n            default: \"right\"\r\n        },\r\n\r\n        /**\r\n         * A v-model, that - when you set it to true - will trigger an update to re-align the popOver.\r\n         * This is useful if the content in the popOver is dynamic.\r\n         */\r\n        triggerUpdate: {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    });\r\n\r\n    const emit = defineEmits<{\r\n        (e: \"update:isVisible\", v: boolean): void\r\n        (e: \"update:triggerUpdate\", v: boolean): void\r\n    }>();\r\n\r\n    const activatorEl = ref<HTMLElement | null>(null);\r\n    const popOverEl = ref<HTMLElement | null>(null);\r\n\r\n    const isPopOverVisible = ref(false);\r\n    const isHovering = ref(false);\r\n\r\n    const popOverStyle = ref<Record<string, string>>({ display: \"none\" });\r\n\r\n    const popOverId = \"popover-\" + newGuid();\r\n\r\n    watch(isHovering, (isHover) => {\r\n        if (isHover) {\r\n            // Show PopOver after a small delay\r\n            setTimeout(() => {\r\n                if (isHovering.value) {\r\n                    isPopOverVisible.value = true;\r\n                }\r\n            }, 50);\r\n        }\r\n        else {\r\n            // Hide Popover if unhovered for a small time\r\n            setTimeout(() => {\r\n                if (!isHovering.value) {\r\n                    isPopOverVisible.value = false;\r\n                }\r\n            }, 100);\r\n        }\r\n    });\r\n\r\n    watch(() => props.triggerUpdate, () => {\r\n        if (props.triggerUpdate) {\r\n            popOverStyle.value = { ...popOverStyle.value, ...getPositionStyles() };\r\n            emit(\"update:triggerUpdate\", false);\r\n        }\r\n    });\r\n\r\n    watch(isPopOverVisible, isVisible => {\r\n        if (isVisible) {\r\n            showPopOver();\r\n        }\r\n        else {\r\n            hidePopOver();\r\n        }\r\n        emit(\"update:isVisible\", isVisible);\r\n    });\r\n\r\n    watch(() => props.isVisible, (isVisible) => {\r\n        isPopOverVisible.value = isVisible;\r\n    }, { immediate: true });\r\n\r\n    watch(activatorEl, manageListeners);\r\n    watch(popOverEl, manageListeners);\r\n\r\n    function manageListeners(newEl, oldEl): void {\r\n        if (oldEl) {\r\n            // Remove old listeners if there's a previous element\r\n            oldEl.removeEventListener(\"mouseenter\", onMouseEnter);\r\n            oldEl.removeEventListener(\"mouseleave\", onMouseLeave);\r\n        }\r\n\r\n        if (newEl) {\r\n            // Remove old listeners if there's a previous element\r\n            newEl.addEventListener(\"mouseenter\", onMouseEnter);\r\n            newEl.addEventListener(\"mouseleave\", onMouseLeave);\r\n        }\r\n    }\r\n\r\n    function onMouseEnter(): void {\r\n        isHovering.value = true;\r\n    }\r\n\r\n    function onMouseLeave(): void {\r\n        isHovering.value = false;\r\n    }\r\n\r\n    async function showPopOver(): Promise<void> {\r\n        activatorEl.value?.setAttribute(\"aria-describedby\", popOverId);\r\n        // Show it, but keep it invisible so we can measure it\r\n        popOverStyle.value = { display: \"block\", opacity: \"0\" };\r\n        // Wait until styles are rendered\r\n        await nextTick();\r\n        // Now we can measure and position it and make it visible\r\n        popOverStyle.value = { display: \"block\", opacity: \"1\", ...getPositionStyles() };\r\n    }\r\n\r\n    async function hidePopOver(): Promise<void> {\r\n        // Make it fade out\r\n        popOverStyle.value.opacity = \"0\";\r\n        // Wait until the styles are rendered\r\n        await nextTick();\r\n\r\n        // Once the opacity transition is done, finish hiding the popOver fully\r\n        setTimeout(() => {\r\n            if (!isHovering.value) {\r\n                activatorEl.value?.removeAttribute(\"aria-describedby\");\r\n                popOverStyle.value = { display: \"none\" };\r\n            }\r\n        }, 150);\r\n    }\r\n\r\n    function getPositionStyles(): Record<string, string> {\r\n        const boxA = getElementBox(activatorEl.value);\r\n        const boxP = getElementBox(popOverEl.value);\r\n\r\n        if (props.placement == \"top\") {\r\n            console.log(\"TOP\", { boxA, boxP });\r\n            return {\r\n                left: boxA.left + (boxA.width / 2) - (boxP.width / 2) + \"px\",\r\n                top: boxA.top - boxP.height + \"px\"\r\n            };\r\n        }\r\n\r\n        if (props.placement == \"bottom\") {\r\n            return {\r\n                left: boxA.left + boxA.width / 2 - boxP.width / 2 + \"px\",\r\n                top: boxA.top + boxA.height + \"px\"\r\n            };\r\n        }\r\n\r\n        if (props.placement == \"left\") {\r\n            return {\r\n                left: boxA.left - boxP.width + \"px\",\r\n                top: boxA.top + (boxA.height / 2) - (boxP.height / 2) + \"px\"\r\n            };\r\n        }\r\n\r\n        // Else \"right\"\r\n        return {\r\n            left: boxA.left + boxA.width + \"px\",\r\n            top: boxA.top + (boxA.height / 2) - (boxP.height / 2) + \"px\"\r\n        };\r\n    }\r\n\r\n    type BoxDimensions = {\r\n        left: number,\r\n        top: number,\r\n        height: number,\r\n        width: number\r\n    };\r\n\r\n    function getElementBox(el: HTMLElement | null): BoxDimensions {\r\n        if (!el) {\r\n            return { left: 0, top: 0, height: 0, width: 0 } as const;\r\n        }\r\n\r\n        return {\r\n            left: el.offsetLeft,\r\n            top: el.offsetTop,\r\n            height: el.offsetHeight,\r\n            width: el.offsetWidth\r\n        } as const;\r\n    }\r\n</script>"],"names":["activatorEl","ref","popOverEl","isPopOverVisible","isHovering","popOverStyle","display","popOverId","newGuid","watch","isHover","setTimeout","value","props","triggerUpdate","_objectSpread","getPositionStyles","emit","isVisible","showPopOver","hidePopOver","immediate","manageListeners","newEl","oldEl","removeEventListener","onMouseEnter","onMouseLeave","addEventListener","_showPopOver","apply","arguments","_asyncToGenerator","_activatorEl$value","setAttribute","opacity","nextTick","_hidePopOver","_activatorEl$value2","removeAttribute","boxA","getElementBox","boxP","placement","console","log","left","width","top","height","el","offsetLeft","offsetTop","offsetHeight","offsetWidth"],"mappings":"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"}