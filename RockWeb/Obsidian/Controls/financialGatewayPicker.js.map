{"version":3,"file":"financialGatewayPicker.js","sources":["../../../Framework/Controls/financialGatewayPicker.ts"],"sourcesContent":["// <copyright>\r\n// Copyright by the Spark Development Network\r\n//\r\n// Licensed under the Rock Community License (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n// http://www.rockrms.com/license\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n// </copyright>\r\n//\r\n\r\nimport { standardAsyncPickerProps, useStandardAsyncPickerProps, useVModelPassthrough } from \"@Obsidian/Utility/component\";\r\nimport { useHttp } from \"@Obsidian/Utility/http\";\r\nimport { FinancialGatewayPickerGetFinancialGatewaysOptionsBag } from \"@Obsidian/ViewModels/Rest/Controls/financialGatewayPickerGetFinancialGatewaysOptionsBag\";\r\nimport { ListItemBag } from \"@Obsidian/ViewModels/Utility/listItemBag\";\r\nimport { computed, defineComponent, PropType, ref, watch } from \"vue\";\r\nimport BaseAsyncPicker from \"./baseAsyncPicker\";\r\n\r\nexport default defineComponent({\r\n    name: \"FinancialGatewayPicker\",\r\n\r\n    components: {\r\n        BaseAsyncPicker\r\n    },\r\n\r\n    props: {\r\n        modelValue: {\r\n            type: Object as PropType<ListItemBag | ListItemBag[] | null>,\r\n            required: false\r\n        },\r\n\r\n        includeInactive: {\r\n            type: Boolean as PropType<boolean>,\r\n            default: false\r\n        },\r\n\r\n        showAllGatewayComponents: {\r\n            type: Boolean as PropType<boolean>,\r\n            default: false\r\n        },\r\n\r\n        ...standardAsyncPickerProps\r\n    },\r\n\r\n    emits: {\r\n        \"update:modelValue\": (_value: ListItemBag | ListItemBag[] | null) => true\r\n    },\r\n\r\n    setup(props, { emit }) {\r\n        // #region Values\r\n\r\n        const internalValue = useVModelPassthrough(props, \"modelValue\", emit);\r\n        const standardProps = useStandardAsyncPickerProps(props);\r\n        const http = useHttp();\r\n        const loadedItems = ref<ListItemBag[] | null>(null);\r\n\r\n        // #endregion\r\n\r\n        // #region Computed Values\r\n\r\n        /**\r\n         * The actual items to make available to the picker. This allows us to do any\r\n         * post-processing, such as adding additional items, and still be lazy loaded as well.\r\n         */\r\n        const actualItems = computed((): ListItemBag[] | (() => Promise<ListItemBag[]>) => {\r\n            return loadedItems.value || loadOptions;\r\n        });\r\n\r\n        // #endregion\r\n\r\n        // #region Functions\r\n\r\n        /**\r\n         * Loads the items from the server.\r\n         */\r\n        const loadOptions = async (): Promise<ListItemBag[]> => {\r\n            const options: Partial<FinancialGatewayPickerGetFinancialGatewaysOptionsBag> = {\r\n                includeInactive: props.includeInactive,\r\n                showAllGatewayComponents: props.showAllGatewayComponents\r\n            };\r\n\r\n            const result = await http.post<ListItemBag[]>(\"/api/v2/Controls/FinancialGatewayPickerGetFinancialGateways\", undefined, options);\r\n\r\n            if (result.isSuccess && result.data) {\r\n                let items = result.data;\r\n\r\n                // If we have some selected values, add them to the list if not already present.\r\n                if (internalValue.value && Array.isArray(internalValue.value)) {\r\n                    // Get the selected values that don't already exist in the list and add them\r\n                    items = internalValue.value.filter(gateway => !items.some(item => item.value === gateway.value)).concat(items);\r\n                }\r\n                // If we have a single selected value & isn't already in the list, add it to the list.\r\n                else if (internalValue.value && !Array.isArray(internalValue.value) && internalValue.value.value && !items.some(item => item.value === (internalValue.value as ListItemBag).value)) {\r\n                    // Add it in at the front if not already in the list\r\n                    items.unshift(internalValue.value);\r\n                }\r\n\r\n                loadedItems.value = items;\r\n                return items;\r\n            }\r\n            else {\r\n                console.error(result.errorMessage ?? \"Unknown error while loading data.\");\r\n                loadedItems.value = [];\r\n                return [];\r\n            }\r\n        };\r\n\r\n        // #endregion\r\n\r\n        // #region Watchers\r\n\r\n        watch(() => props.includeInactive, () => {\r\n            loadedItems.value = null;\r\n        });\r\n\r\n        watch(() => props.showAllGatewayComponents, () => {\r\n            loadedItems.value = null;\r\n        });\r\n\r\n        // #endregion\r\n\r\n        return {\r\n            actualItems,\r\n            internalValue,\r\n            standardProps\r\n        };\r\n    },\r\n\r\n    template: `\r\n<BaseAsyncPicker v-model=\"internalValue\"\r\n    v-bind=\"standardProps\"\r\n    :items=\"actualItems\" />\r\n`\r\n});\r\n"],"names":["defineComponent","name","components","BaseAsyncPicker","props","_objectSpread","modelValue","type","Object","required","includeInactive","Boolean","default","showAllGatewayComponents","standardAsyncPickerProps","emits","_value","setup","_ref","emit","internalValue","useVModelPassthrough","standardProps","useStandardAsyncPickerProps","http","useHttp","loadedItems","ref","actualItems","computed","value","loadOptions","_ref2","_asyncToGenerator","options","result","post","undefined","isSuccess","data","items","Array","isArray","filter","gateway","some","item","concat","unshift","_result$errorMessage","console","error","errorMessage","apply","arguments","watch","template"],"mappings":"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"}