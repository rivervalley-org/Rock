{"version":3,"file":"basicTimePicker.js","sources":["../../../Framework/Controls/basicTimePicker.ts"],"sourcesContent":["ï»¿// <copyright>\r\n// Copyright by the Spark Development Network\r\n//\r\n// Licensed under the Rock Community License (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n// http://www.rockrms.com/license\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n// </copyright>\r\n\r\nimport { watch } from \"vue\";\r\nimport { defineComponent, PropType, ref, Ref } from \"vue\";\r\nimport { toNumber } from \"@Obsidian/Utility/numberUtils\";\r\nimport { padLeft } from \"@Obsidian/Utility/stringUtils\";\r\n\r\n/** The value expected by the TimePicker. */\r\nexport type BasicTimePickerValue = {\r\n    /** Hour of the time, 0-23. */\r\n    hour?: number;\r\n\r\n    /** Minute of the time, 0-59. */\r\n    minute?: number;\r\n};\r\n\r\nexport default defineComponent({\r\n    name: \"BasicTimePicker\",\r\n\r\n    components: {\r\n    },\r\n\r\n    props: {\r\n        modelValue: {\r\n            type: Object as PropType<BasicTimePickerValue>,\r\n            default: {}\r\n        },\r\n        disabled: {\r\n            type: Boolean as PropType<boolean>,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    emits: [ \"update:modelValue\" ],\r\n\r\n    setup(props, { emit }) {\r\n        const internalHour: Ref<number | null> = ref(null);\r\n        const internalMinute: Ref<number | null> = ref(null);\r\n        const internalMeridiem: Ref<\"AM\" | \"PM\"> = ref(\"AM\");\r\n        const internalValue: Ref<string> = ref(\"\");\r\n\r\n        function keyPress(e: KeyboardEvent): boolean {\r\n            if (e.key === \"a\" || e.key === \"p\" || e.key === \"A\" || e.key == \"P\") {\r\n                internalMeridiem.value = e.key === \"a\" || e.key === \"A\" ? \"AM\" : \"PM\";\r\n                maybeUpdateValue();\r\n\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n\r\n            if (/^[0-9:]$/.test(e.key) === false) {\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        function updateValue(): void {\r\n            const values = /(\\d+)(?::(\\d+))?/.exec(internalValue.value);\r\n            const value: BasicTimePickerValue = {};\r\n\r\n            if(values !== null) {\r\n                value.hour = toNumber(values[1]) + (internalMeridiem.value === \"PM\" ? 12 : 0);\r\n                value.minute = values.length > 2 ? toNumber(values[2]) : 0;\r\n\r\n                value.hour = Math.max(0, Math.min(23, value.hour));\r\n                value.minute = Math.max(0, Math.min(59, value.minute));\r\n            }\r\n\r\n            emit(\"update:modelValue\", value);\r\n        }\r\n\r\n        function maybeUpdateValue(): void {\r\n            const values = /(\\d+):(\\d+)/.exec(internalValue.value);\r\n\r\n            if(values !== null) {\r\n                updateValue();\r\n            }\r\n        }\r\n\r\n        function toggleMeridiem(): void {\r\n            if (!props.disabled) {\r\n                internalMeridiem.value = internalMeridiem.value === \"AM\" ? \"PM\" : \"AM\";\r\n                maybeUpdateValue();\r\n            }\r\n        }\r\n\r\n        watch(() => props.modelValue, (): void => {\r\n            ///^(\\d{1,2})(?:\\:(\\d{2})(?: ?([aApP])[mM]?)?)?$/\r\n            if (props.modelValue.hour) {\r\n                if (props.modelValue.hour > 12) {\r\n                    internalHour.value = props.modelValue.hour - 12;\r\n                }\r\n                else {\r\n                    internalHour.value = props.modelValue.hour;\r\n                }\r\n\r\n                if (props.modelValue.hour >= 12) {\r\n                    internalMeridiem.value = \"PM\";\r\n                }\r\n            }\r\n            else {\r\n                internalHour.value = null;\r\n            }\r\n\r\n            if (props.modelValue.minute) {\r\n                internalMinute.value = props.modelValue.minute;\r\n            }\r\n            else if (internalHour.value != null) {\r\n                internalMinute.value = 0;\r\n            }\r\n            else {\r\n                internalMinute.value = null;\r\n            }\r\n\r\n            if (internalHour.value === null || internalMinute.value === null) {\r\n                return;\r\n            }\r\n\r\n            internalValue.value = `${internalHour.value}:${padLeft(internalMinute.value.toString(), 2, \"0\")}`;\r\n        }, { immediate: true });\r\n\r\n        return {\r\n            internalHour,\r\n            internalMinute,\r\n            internalMeridiem,\r\n            internalValue,\r\n            keyPress,\r\n            updateValue,\r\n            toggleMeridiem\r\n        };\r\n    },\r\n\r\n    template: `\r\n<div class=\"input-group input-width-md\">\r\n    <input class=\"form-control\" type=\"text\" v-model=\"internalValue\" @change=\"updateValue\" @keypress=\"keyPress\" :disabled=\"disabled\" />\r\n    <span class=\"input-group-addon clickable\" @click.prevent=\"toggleMeridiem\">{{ internalMeridiem }}</span>\r\n</div>\r\n`\r\n});\r\n"],"names":["defineComponent","name","components","props","modelValue","type","Object","default","disabled","Boolean","emits","setup","_ref","emit","internalHour","ref","internalMinute","internalMeridiem","internalValue","keyPress","e","key","value","maybeUpdateValue","preventDefault","test","updateValue","values","exec","hour","toNumber","minute","length","Math","max","min","toggleMeridiem","watch","concat","padLeft","toString","immediate","template"],"mappings":";;;;;;;;;;;;;;;AA8BA,qDAAeA,eAAe,CAAC;YAC3BC,EAAAA,IAAI,EAAE,iBAAiB;cAEvBC,UAAU,EAAE,EACX;YAEDC,EAAAA,KAAK,EAAE;YACHC,IAAAA,UAAU,EAAE;YACRC,MAAAA,IAAI,EAAEC,MAAwC;YAC9CC,MAAAA,OAAO,EAAE,EAAC;iBACb;YACDC,IAAAA,QAAQ,EAAE;YACNH,MAAAA,IAAI,EAAEI,OAA4B;YAClCF,MAAAA,OAAO,EAAE,KAAA;YACb,KAAA;eACH;cAEDG,KAAK,EAAE,CAAE,mBAAmB,CAAE;YAE9BC,EAAAA,KAAKA,CAACR,KAAK,EAAAS,IAAA,EAAY;YAAA,IAAA,IAARC,IAAI,GAAAD,IAAA,CAAJC,IAAI,CAAA;YACf,IAAA,IAAMC,YAAgC,GAAGC,GAAG,CAAC,IAAI,CAAC,CAAA;YAClD,IAAA,IAAMC,cAAkC,GAAGD,GAAG,CAAC,IAAI,CAAC,CAAA;YACpD,IAAA,IAAME,gBAAkC,GAAGF,GAAG,CAAC,IAAI,CAAC,CAAA;YACpD,IAAA,IAAMG,aAA0B,GAAGH,GAAG,CAAC,EAAE,CAAC,CAAA;gBAE1C,SAASI,QAAQA,CAACC,CAAgB,EAAW;kBACzC,IAAIA,CAAC,CAACC,GAAG,KAAK,GAAG,IAAID,CAAC,CAACC,GAAG,KAAK,GAAG,IAAID,CAAC,CAACC,GAAG,KAAK,GAAG,IAAID,CAAC,CAACC,GAAG,IAAI,GAAG,EAAE;YACjEJ,QAAAA,gBAAgB,CAACK,KAAK,GAAGF,CAAC,CAACC,GAAG,KAAK,GAAG,IAAID,CAAC,CAACC,GAAG,KAAK,GAAG,GAAG,IAAI,GAAG,IAAI,CAAA;YACrEE,QAAAA,gBAAgB,EAAE,CAAA;oBAElBH,CAAC,CAACI,cAAc,EAAE,CAAA;YAClB,QAAA,OAAO,KAAK,CAAA;YAChB,OAAA;kBAEA,IAAI,UAAU,CAACC,IAAI,CAACL,CAAC,CAACC,GAAG,CAAC,KAAK,KAAK,EAAE;oBAClCD,CAAC,CAACI,cAAc,EAAE,CAAA;YAClB,QAAA,OAAO,KAAK,CAAA;YAChB,OAAA;YAEA,MAAA,OAAO,IAAI,CAAA;YACf,KAAA;gBAEA,SAASE,WAAWA,GAAS;kBACzB,IAAMC,MAAM,GAAG,kBAAkB,CAACC,IAAI,CAACV,aAAa,CAACI,KAAK,CAAC,CAAA;kBAC3D,IAAMA,KAA2B,GAAG,EAAE,CAAA;kBAEtC,IAAGK,MAAM,KAAK,IAAI,EAAE;oBAChBL,KAAK,CAACO,IAAI,GAAGC,QAAQ,CAACH,MAAM,CAAC,CAAC,CAAC,CAAC,IAAIV,gBAAgB,CAACK,KAAK,KAAK,IAAI,GAAG,EAAE,GAAG,CAAC,CAAC,CAAA;YAC7EA,QAAAA,KAAK,CAACS,MAAM,GAAGJ,MAAM,CAACK,MAAM,GAAG,CAAC,GAAGF,QAAQ,CAACH,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;YAE1DL,QAAAA,KAAK,CAACO,IAAI,GAAGI,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,EAAE,EAAEb,KAAK,CAACO,IAAI,CAAC,CAAC,CAAA;YAClDP,QAAAA,KAAK,CAACS,MAAM,GAAGE,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,EAAE,EAAEb,KAAK,CAACS,MAAM,CAAC,CAAC,CAAA;YAC1D,OAAA;YAEAlB,MAAAA,IAAI,CAAC,mBAAmB,EAAES,KAAK,CAAC,CAAA;YACpC,KAAA;gBAEA,SAASC,gBAAgBA,GAAS;kBAC9B,IAAMI,MAAM,GAAG,aAAa,CAACC,IAAI,CAACV,aAAa,CAACI,KAAK,CAAC,CAAA;kBAEtD,IAAGK,MAAM,KAAK,IAAI,EAAE;YAChBD,QAAAA,WAAW,EAAE,CAAA;YACjB,OAAA;YACJ,KAAA;gBAEA,SAASU,cAAcA,GAAS;YAC5B,MAAA,IAAI,CAACjC,KAAK,CAACK,QAAQ,EAAE;oBACjBS,gBAAgB,CAACK,KAAK,GAAGL,gBAAgB,CAACK,KAAK,KAAK,IAAI,GAAG,IAAI,GAAG,IAAI,CAAA;YACtEC,QAAAA,gBAAgB,EAAE,CAAA;YACtB,OAAA;YACJ,KAAA;YAEAc,IAAAA,KAAK,CAAC,MAAMlC,KAAK,CAACC,UAAU,EAAE,MAAY;YAEtC,MAAA,IAAID,KAAK,CAACC,UAAU,CAACyB,IAAI,EAAE;YACvB,QAAA,IAAI1B,KAAK,CAACC,UAAU,CAACyB,IAAI,GAAG,EAAE,EAAE;sBAC5Bf,YAAY,CAACQ,KAAK,GAAGnB,KAAK,CAACC,UAAU,CAACyB,IAAI,GAAG,EAAE,CAAA;YACnD,SAAC,MACI;YACDf,UAAAA,YAAY,CAACQ,KAAK,GAAGnB,KAAK,CAACC,UAAU,CAACyB,IAAI,CAAA;YAC9C,SAAA;YAEA,QAAA,IAAI1B,KAAK,CAACC,UAAU,CAACyB,IAAI,IAAI,EAAE,EAAE;sBAC7BZ,gBAAgB,CAACK,KAAK,GAAG,IAAI,CAAA;YACjC,SAAA;YACJ,OAAC,MACI;oBACDR,YAAY,CAACQ,KAAK,GAAG,IAAI,CAAA;YAC7B,OAAA;YAEA,MAAA,IAAInB,KAAK,CAACC,UAAU,CAAC2B,MAAM,EAAE;YACzBf,QAAAA,cAAc,CAACM,KAAK,GAAGnB,KAAK,CAACC,UAAU,CAAC2B,MAAM,CAAA;YAClD,OAAC,MACI,IAAIjB,YAAY,CAACQ,KAAK,IAAI,IAAI,EAAE;oBACjCN,cAAc,CAACM,KAAK,GAAG,CAAC,CAAA;YAC5B,OAAC,MACI;oBACDN,cAAc,CAACM,KAAK,GAAG,IAAI,CAAA;YAC/B,OAAA;kBAEA,IAAIR,YAAY,CAACQ,KAAK,KAAK,IAAI,IAAIN,cAAc,CAACM,KAAK,KAAK,IAAI,EAAE;YAC9D,QAAA,OAAA;YACJ,OAAA;kBAEAJ,aAAa,CAACI,KAAK,GAAA,EAAA,CAAAgB,MAAA,CAAMxB,YAAY,CAACQ,KAAK,EAAAgB,GAAAA,CAAAA,CAAAA,MAAA,CAAIC,OAAO,CAACvB,cAAc,CAACM,KAAK,CAACkB,QAAQ,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAE,CAAA;YACrG,KAAC,EAAE;YAAEC,MAAAA,SAAS,EAAE,IAAA;YAAK,KAAC,CAAC,CAAA;gBAEvB,OAAO;kBACH3B,YAAY;kBACZE,cAAc;kBACdC,gBAAgB;kBAChBC,aAAa;kBACbC,QAAQ;kBACRO,WAAW;YACXU,MAAAA,cAAAA;iBACH,CAAA;eACJ;cAEDM,QAAQ,EAAA,6TAAA;YAMZ,CAAC,EAAC;;;;;;;;"}