{"version":3,"file":"following.js","sources":["../../../Framework/Controls/following.ts"],"sourcesContent":["// <copyright>\r\n// Copyright by the Spark Development Network\r\n//\r\n// Licensed under the Rock Community License (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n// http://www.rockrms.com/license\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n// </copyright>\r\n//\r\n\r\nimport { Guid } from \"@Obsidian/Types\";\r\nimport { useHttp } from \"@Obsidian/Utility/http\";\r\nimport { FollowingGetFollowingOptionsBag } from \"@Obsidian/ViewModels/Rest/Controls/followingGetFollowingOptionsBag\";\r\nimport { FollowingGetFollowingResponseBag } from \"@Obsidian/ViewModels/Rest/Controls/followingGetFollowingResponseBag\";\r\nimport { FollowingSetFollowingOptionsBag } from \"@Obsidian/ViewModels/Rest/Controls/followingSetFollowingOptionsBag\";\r\nimport { computed, defineComponent, PropType, ref, watch } from \"vue\";\r\n\r\n/** Displays a following icon for the given entity. */\r\nexport default defineComponent({\r\n    name: \"Following\",\r\n\r\n    components: {\r\n    },\r\n\r\n    props: {\r\n        /** The unique identifier of the entity type that will be followed. */\r\n        entityTypeGuid: {\r\n            type: String as PropType<Guid>,\r\n            required: false\r\n        },\r\n\r\n        /** The identifier key of the entity that will be followed. */\r\n        entityKey: {\r\n            type: String as PropType<string>,\r\n            required: false\r\n        },\r\n\r\n        /** True if the following state should not be modified. */\r\n        disabled: {\r\n            type: Boolean as PropType<boolean>,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    setup(props) {\r\n        // #region Values\r\n\r\n        const http = useHttp();\r\n        const isEntityFollowed = ref<boolean | null>(null);\r\n\r\n        // #endregion\r\n\r\n        // #region Computed Values\r\n\r\n        const isVisible = computed((): boolean => {\r\n            return !!props.entityTypeGuid && !!props.entityKey;\r\n        });\r\n\r\n        const followingClass = computed((): string => {\r\n            if (props.disabled) {\r\n                return isEntityFollowed ? \"text-primary\" : \"\";\r\n            }\r\n\r\n            return isEntityFollowed.value ? \"clickable text-primary\" : \"clickable\";\r\n        });\r\n\r\n        const iconClass = computed((): string => {\r\n            return isEntityFollowed.value ? \"fa fa-star\" : \"fa fa-star-o\";\r\n        });\r\n\r\n        const tooltip = computed((): string | null => {\r\n            if (props.disabled) {\r\n                return null;\r\n            }\r\n\r\n            return isEntityFollowed.value ? \"Click to stop following.\" : \"Click to follow.\";\r\n        });\r\n\r\n        // #endregion\r\n\r\n        // #region Functions\r\n\r\n        /**\r\n         * Get the current followed state for the entity we are displaying in\r\n         * this following control.\r\n         */\r\n        const getEntityFollowedState = async (): Promise<void> => {\r\n            // If we don't have an entity then mark the state as \"unknown\".\r\n            if (!props.entityTypeGuid || !props.entityKey) {\r\n                isEntityFollowed.value = null;\r\n                return;\r\n            }\r\n\r\n            const data: FollowingGetFollowingOptionsBag = {\r\n                entityTypeGuid: props.entityTypeGuid,\r\n                entityKey: props.entityKey\r\n            };\r\n\r\n            const response = await http.post<FollowingGetFollowingResponseBag>(\"/api/v2/Controls/FollowingGetFollowing\", undefined, data);\r\n\r\n            isEntityFollowed.value = response.isSuccess && response.data && response.data.isFollowing;\r\n        };\r\n\r\n        // #endregion\r\n\r\n        // #region Event Handlers\r\n\r\n        /**\r\n         * Called when the follow icon has been clicked. Attempt to toggle\r\n         * the followed state of the entity.\r\n         */\r\n        const onFollowClick = async (): Promise<void> => {\r\n            // If we are disabled, don't allow the individual to change the state.\r\n            if (props.disabled) {\r\n                return;\r\n            }\r\n\r\n            // Shouldn't really happen, but just make sure we have everything.\r\n            if (isEntityFollowed.value === null || !props.entityTypeGuid || !props.entityKey) {\r\n                return;\r\n            }\r\n\r\n            const data: FollowingSetFollowingOptionsBag = {\r\n                entityTypeGuid: props.entityTypeGuid,\r\n                entityKey: props.entityKey,\r\n                isFollowing: !isEntityFollowed.value\r\n            };\r\n\r\n            const response = await http.post(\"/api/v2/Controls/FollowingSetFollowing\", undefined, data);\r\n\r\n            // If we got a 200 OK response then we can toggle our internal state.\r\n            if (response.isSuccess) {\r\n                isEntityFollowed.value = !isEntityFollowed.value;\r\n            }\r\n            else {\r\n                await alert(\"Unable to update followed state.\");\r\n            }\r\n        };\r\n\r\n        // #endregion\r\n\r\n        // Watch for property values to change and when they do reload the\r\n        // initial followed state.\r\n        watch([() => props.entityTypeGuid, () => props.entityKey], () => {\r\n            getEntityFollowedState();\r\n        });\r\n\r\n        getEntityFollowedState();\r\n\r\n        return {\r\n            followingClass,\r\n            iconClass,\r\n            isVisible,\r\n            onFollowClick,\r\n            tooltip\r\n        };\r\n    },\r\n\r\n    template: `\r\n<span v-if=\"isVisible\" :class=\"followingClass\" :title=\"tooltip\" @click=\"onFollowClick\">\r\n    <i :class=\"iconClass\"></i>\r\n</span>\r\n`\r\n});\r\n"],"names":["defineComponent","name","components","props","entityTypeGuid","type","String","required","entityKey","disabled","Boolean","default","setup","http","useHttp","isEntityFollowed","ref","isVisible","computed","followingClass","value","iconClass","tooltip","getEntityFollowedState","_ref","_asyncToGenerator","data","response","post","undefined","isSuccess","isFollowing","apply","arguments","onFollowClick","_ref2","alert","watch","template"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBA,yCAAeA,eAAe,CAAC;MAC3BC,EAAAA,IAAI,EAAE,WAAW;QAEjBC,UAAU,EAAE,EACX;MAEDC,EAAAA,KAAK,EAAE;MAEHC,IAAAA,cAAc,EAAE;MACZC,MAAAA,IAAI,EAAEC,MAAwB;MAC9BC,MAAAA,QAAQ,EAAE,KAAA;WACb;MAGDC,IAAAA,SAAS,EAAE;MACPH,MAAAA,IAAI,EAAEC,MAA0B;MAChCC,MAAAA,QAAQ,EAAE,KAAA;WACb;MAGDE,IAAAA,QAAQ,EAAE;MACNJ,MAAAA,IAAI,EAAEK,OAA4B;MAClCC,MAAAA,OAAO,EAAE,KAAA;MACb,KAAA;SACH;QAEDC,KAAKA,CAACT,KAAK,EAAE;UAGT,IAAMU,IAAI,GAAGC,OAAO,EAAE,CAAA;MACtB,IAAA,IAAMC,gBAAgB,GAAGC,GAAG,CAAiB,IAAI,CAAC,CAAA;MAMlD,IAAA,IAAMC,SAAS,GAAGC,QAAQ,CAAC,MAAe;YACtC,OAAO,CAAC,CAACf,KAAK,CAACC,cAAc,IAAI,CAAC,CAACD,KAAK,CAACK,SAAS,CAAA;MACtD,KAAC,CAAC,CAAA;MAEF,IAAA,IAAMW,cAAc,GAAGD,QAAQ,CAAC,MAAc;YAC1C,IAAIf,KAAK,CAACM,QAAQ,EAAE;MAChB,QAAA,OAAOM,gBAAgB,GAAG,cAAc,GAAG,EAAE,CAAA;MACjD,OAAA;MAEA,MAAA,OAAOA,gBAAgB,CAACK,KAAK,GAAG,wBAAwB,GAAG,WAAW,CAAA;MAC1E,KAAC,CAAC,CAAA;MAEF,IAAA,IAAMC,SAAS,GAAGH,QAAQ,CAAC,MAAc;MACrC,MAAA,OAAOH,gBAAgB,CAACK,KAAK,GAAG,YAAY,GAAG,cAAc,CAAA;MACjE,KAAC,CAAC,CAAA;MAEF,IAAA,IAAME,OAAO,GAAGJ,QAAQ,CAAC,MAAqB;YAC1C,IAAIf,KAAK,CAACM,QAAQ,EAAE;MAChB,QAAA,OAAO,IAAI,CAAA;MACf,OAAA;MAEA,MAAA,OAAOM,gBAAgB,CAACK,KAAK,GAAG,0BAA0B,GAAG,kBAAkB,CAAA;MACnF,KAAC,CAAC,CAAA;MAUF,IAAA,IAAMG,sBAAsB,GAAA,YAAA;MAAA,MAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAG,aAA2B;cAEtD,IAAI,CAACtB,KAAK,CAACC,cAAc,IAAI,CAACD,KAAK,CAACK,SAAS,EAAE;gBAC3CO,gBAAgB,CAACK,KAAK,GAAG,IAAI,CAAA;MAC7B,UAAA,OAAA;MACJ,SAAA;MAEA,QAAA,IAAMM,IAAqC,GAAG;gBAC1CtB,cAAc,EAAED,KAAK,CAACC,cAAc;gBACpCI,SAAS,EAAEL,KAAK,CAACK,SAAAA;eACpB,CAAA;cAED,IAAMmB,QAAQ,GAASd,MAAAA,IAAI,CAACe,IAAI,CAAmC,wCAAwC,EAAEC,SAAS,EAAEH,IAAI,CAAC,CAAA;MAE7HX,QAAAA,gBAAgB,CAACK,KAAK,GAAGO,QAAQ,CAACG,SAAS,IAAIH,QAAQ,CAACD,IAAI,IAAIC,QAAQ,CAACD,IAAI,CAACK,WAAW,CAAA;aAC5F,CAAA,CAAA;MAAA,MAAA,OAAA,SAfKR,sBAAsBA,GAAA;MAAA,QAAA,OAAAC,IAAA,CAAAQ,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,CAAA;MAAA,OAAA,CAAA;WAe3B,EAAA,CAAA;MAUD,IAAA,IAAMC,aAAa,GAAA,YAAA;MAAA,MAAA,IAAAC,KAAA,GAAAV,iBAAA,CAAG,aAA2B;cAE7C,IAAItB,KAAK,CAACM,QAAQ,EAAE;MAChB,UAAA,OAAA;MACJ,SAAA;MAGA,QAAA,IAAIM,gBAAgB,CAACK,KAAK,KAAK,IAAI,IAAI,CAACjB,KAAK,CAACC,cAAc,IAAI,CAACD,KAAK,CAACK,SAAS,EAAE;MAC9E,UAAA,OAAA;MACJ,SAAA;MAEA,QAAA,IAAMkB,IAAqC,GAAG;gBAC1CtB,cAAc,EAAED,KAAK,CAACC,cAAc;gBACpCI,SAAS,EAAEL,KAAK,CAACK,SAAS;gBAC1BuB,WAAW,EAAE,CAAChB,gBAAgB,CAACK,KAAAA;eAClC,CAAA;cAED,IAAMO,QAAQ,GAASd,MAAAA,IAAI,CAACe,IAAI,CAAC,wCAAwC,EAAEC,SAAS,EAAEH,IAAI,CAAC,CAAA;cAG3F,IAAIC,QAAQ,CAACG,SAAS,EAAE;MACpBf,UAAAA,gBAAgB,CAACK,KAAK,GAAG,CAACL,gBAAgB,CAACK,KAAK,CAAA;MACpD,SAAC,MACI;gBACD,MAAMgB,KAAK,CAAC,kCAAkC,CAAC,CAAA;MACnD,SAAA;aACH,CAAA,CAAA;MAAA,MAAA,OAAA,SA1BKF,aAAaA,GAAA;MAAA,QAAA,OAAAC,KAAA,CAAAH,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,CAAA;MAAA,OAAA,CAAA;WA0BlB,EAAA,CAAA;MAMDI,IAAAA,KAAK,CAAC,CAAC,MAAMlC,KAAK,CAACC,cAAc,EAAE,MAAMD,KAAK,CAACK,SAAS,CAAC,EAAE,MAAM;MAC7De,MAAAA,sBAAsB,EAAE,CAAA;MAC5B,KAAC,CAAC,CAAA;MAEFA,IAAAA,sBAAsB,EAAE,CAAA;UAExB,OAAO;YACHJ,cAAc;YACdE,SAAS;YACTJ,SAAS;YACTiB,aAAa;MACbZ,MAAAA,OAAAA;WACH,CAAA;SACJ;QAEDgB,QAAQ,EAAA,gJAAA;MAKZ,CAAC,EAAC;;;;;;;;"}