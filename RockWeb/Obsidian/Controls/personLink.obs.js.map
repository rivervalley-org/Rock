{"version":3,"file":"personLink.obs.js","sources":["../../../Framework/Controls/personLink.obs"],"sourcesContent":["<!-- Copyright by the Spark Development Network; Licensed under the Rock Community License -->\r\n<template>\r\n    <PopOver v-model:isVisible=\"isVisible\" :placement=\"popOverPlacement\" v-model:triggerUpdate=\"triggerUpdate\">\r\n        <template #activator=\"props\">\r\n            <a v-bind=\"props\" :href=\"'/Person/' + personId\"><i v-if=\"photoId != 0\" class=\"fa fa-circle\"></i> <strong>{{ personName }}</strong></a>\r\n        </template>\r\n        <template #popOverContent>\r\n            <Loading :isLoading=\"!popOverContent\" isSmall>\r\n                <div v-html=\"popOverContent\"></div>\r\n            </Loading>\r\n        </template>\r\n    </PopOver>\r\n    <small v-if=\"role\"> ({{ role }})</small>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n    import { nextTick, ref, PropType, watch } from \"vue\";\r\n    import { useHttp } from \"@Obsidian/Utility/http\";\r\n    import PopOver from \"./popOver.obs\";\r\n    import { PersonLinkGetPopupHtmlOptionsBag } from \"@Obsidian/ViewModels/Rest/Controls/personLinkGetPopupHtmlOptionsBag\";\r\n    import { useSecurityGrantToken } from \"@Obsidian/Utility/block\";\r\n    import Loading from \"./loading\";\r\n\r\n    const props = defineProps({\r\n        /** ID is used to create the link and fetch person data */\r\n        personId: {\r\n            type: Number,\r\n            required: true\r\n        },\r\n\r\n        /** The name to show and link */\r\n        personName: {\r\n            type: String,\r\n            default: \"\"\r\n        },\r\n\r\n        /** If provided, will be shown after the name in parenthesis */\r\n        role: {\r\n            type: String,\r\n            default: \"\"\r\n        },\r\n\r\n        /** If provided, a dot will appear to the left of the name */\r\n        photoId: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n\r\n        /** Which side should the popOver appear on? */\r\n        popOverPlacement: {\r\n            type: String as PropType<\"top\" | \"right\" | \"bottom\" | \"left\">,\r\n            default: \"right\"\r\n        },\r\n    });\r\n\r\n    const http = useHttp();\r\n    const isVisible = ref(false);\r\n    const popOverContent = ref(\"\");\r\n    const triggerUpdate = ref(false);\r\n    const securityGrantToken = useSecurityGrantToken();\r\n\r\n    watch(isVisible, () => {\r\n        if (isVisible.value && !popOverContent.value) {\r\n            getPopOverContent();\r\n        }\r\n    });\r\n\r\n    watch(popOverContent, async () => {\r\n        if (isVisible.value) {\r\n            await nextTick();\r\n            triggerUpdate.value = true;\r\n        }\r\n    });\r\n\r\n    watch(() => props.personId, () => {\r\n        popOverContent.value = \"\";\r\n    });\r\n\r\n    /**\r\n     * Loads the content from the server.\r\n     */\r\n    async function getPopOverContent(): Promise<void> {\r\n        const options: PersonLinkGetPopupHtmlOptionsBag = {\r\n            personId: props.personId,\r\n            securityGrantToken: securityGrantToken.value\r\n        };\r\n        const result = await http.post<string>(\"/api/v2/Controls/PersonLinkGetPopupHtml\", undefined, options);\r\n\r\n        if (result.isSuccess && result.data) {\r\n            popOverContent.value = result.data;\r\n        }\r\n        else {\r\n            popOverContent.value = \"Unknown error while loading this person's data.\";\r\n        }\r\n    }\r\n\r\n</script>"],"names":["http","useHttp","isVisible","ref","popOverContent","triggerUpdate","securityGrantToken","useSecurityGrantToken","watch","value","getPopOverContent","_asyncToGenerator","nextTick","props","personId","_getPopOverContent","apply","arguments","options","result","post","undefined","isSuccess","data"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAuDI,IAAMA,IAAI,GAAGC,OAAO,EAAE,CAAA;MACtB,IAAA,IAAMC,SAAS,GAAGC,GAAG,CAAC,KAAK,CAAC,CAAA;MAC5B,IAAA,IAAMC,cAAc,GAAGD,GAAG,CAAC,EAAE,CAAC,CAAA;MAC9B,IAAA,IAAME,aAAa,GAAGF,GAAG,CAAC,KAAK,CAAC,CAAA;UAChC,IAAMG,kBAAkB,GAAGC,qBAAqB,EAAE,CAAA;UAElDC,KAAK,CAACN,SAAS,EAAE,MAAM;YACnB,IAAIA,SAAS,CAACO,KAAK,IAAI,CAACL,cAAc,CAACK,KAAK,EAAE;MAC1CC,QAAAA,iBAAiB,EAAE,CAAA;MACvB,OAAA;MACJ,KAAC,CAAC,CAAA;MAEFF,IAAAA,KAAK,CAACJ,cAAc,EAAAO,iBAAA,CAAE,aAAY;YAC9B,IAAIT,SAAS,CAACO,KAAK,EAAE;MACjB,QAAA,MAAMG,QAAQ,EAAE,CAAA;cAChBP,aAAa,CAACI,KAAK,GAAG,IAAI,CAAA;MAC9B,OAAA;MACJ,KAAC,CAAC,CAAA,CAAA;MAEFD,IAAAA,KAAK,CAAC,MAAMK,KAAK,CAACC,QAAQ,EAAE,MAAM;YAC9BV,cAAc,CAACK,KAAK,GAAG,EAAE,CAAA;MAC7B,KAAC,CAAC,CAAA;MAAC,IAAA,SAKYC,iBAAiBA,GAAA;MAAA,MAAA,OAAAK,kBAAA,CAAAC,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,CAAA;MAAA,KAAA;MAAA,IAAA,SAAAF,kBAAA,GAAA;YAAAA,kBAAA,GAAAJ,iBAAA,CAAhC,aAAkD;MAC9C,QAAA,IAAMO,OAAyC,GAAG;gBAC9CJ,QAAQ,EAAED,KAAK,CAACC,QAAQ;gBACxBR,kBAAkB,EAAEA,kBAAkB,CAACG,KAAAA;eAC1C,CAAA;cACD,IAAMU,MAAM,GAASnB,MAAAA,IAAI,CAACoB,IAAI,CAAS,yCAAyC,EAAEC,SAAS,EAAEH,OAAO,CAAC,CAAA;MAErG,QAAA,IAAIC,MAAM,CAACG,SAAS,IAAIH,MAAM,CAACI,IAAI,EAAE;MACjCnB,UAAAA,cAAc,CAACK,KAAK,GAAGU,MAAM,CAACI,IAAI,CAAA;MACtC,SAAC,MACI;gBACDnB,cAAc,CAACK,KAAK,GAAG,iDAAiD,CAAA;MAC5E,SAAA;aACH,CAAA,CAAA;MAAA,MAAA,OAAAM,kBAAA,CAAAC,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,CAAA;MAAA,KAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}