{"version":3,"file":"listBox.js","sources":["../../../Framework/Controls/listBox.ts"],"sourcesContent":["// <copyright>\r\n// Copyright by the Spark Development Network\r\n//\r\n// Licensed under the Rock Community License (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n// http://www.rockrms.com/license\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n// </copyright>\r\n//\r\nimport { ListItemBag } from \"@Obsidian/ViewModels/Utility/listItemBag\";\r\nimport { defineComponent, PropType } from \"vue\";\r\nimport { newGuid } from \"@Obsidian/Utility/guid\";\r\nimport RockFormField from \"./rockFormField\";\r\n\r\nexport default defineComponent({\r\n    name: \"ListBox\",\r\n    components: {\r\n        RockFormField\r\n    },\r\n    props: {\r\n        modelValue: {\r\n            type: Array as PropType<Array<string>>,\r\n            default: []\r\n        },\r\n\r\n        items: {\r\n            type: Array as PropType<ListItemBag[]>,\r\n            default: []\r\n        },\r\n\r\n        formControlClasses: {\r\n            type: String as PropType<string>,\r\n            default: \"\"\r\n        },\r\n\r\n        enhanceForLongLists: {\r\n            type: Boolean as PropType<boolean>,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    data: function () {\r\n        return {\r\n            uniqueId: `rock-listbox-${newGuid()}`,\r\n            internalValue: [] as string[],\r\n            isMounted: false\r\n        };\r\n    },\r\n\r\n    computed: {\r\n        /** The compiled list of CSS classes (props and calculated from other inputs) for the select element */\r\n        compiledFormControlClasses(): string {\r\n            if (this.enhanceForLongLists) {\r\n                return this.formControlClasses + \" chosen-select\";\r\n            }\r\n\r\n            return this.formControlClasses;\r\n        }\r\n    },\r\n\r\n    methods: {\r\n        /** Uses jQuery to get the chosen element */\r\n        getChosenJqueryEl() {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            const jquery = <any>window[<any>\"$\"];\r\n            let $chosenDropDown = jquery(this.$refs[\"theSelect\"]);\r\n\r\n            if (!$chosenDropDown || !$chosenDropDown.length) {\r\n                $chosenDropDown = jquery(`#${this.uniqueId}`);\r\n            }\r\n\r\n            return $chosenDropDown;\r\n        },\r\n\r\n        createOrDestroyChosen() {\r\n            if (!this.isMounted) {\r\n                return;\r\n            }\r\n\r\n            const $chosenDropDown = this.getChosenJqueryEl();\r\n\r\n            if (this.enhanceForLongLists) {\r\n                $chosenDropDown\r\n                    .chosen({\r\n                        width: \"100%\",\r\n                        placeholder_text_multiple: \" \",\r\n                        placeholder_text_single: \" \"\r\n                    })\r\n                    .change(() => {\r\n                        this.internalValue = $chosenDropDown.val();\r\n                    });\r\n            }\r\n            else {\r\n                $chosenDropDown.chosen(\"destroy\");\r\n            }\r\n        },\r\n\r\n        syncValue() {\r\n            if (this.internalValue.length === this.modelValue.length && this.internalValue.every((v, i) => v === this.modelValue[i])) {\r\n                return;\r\n            }\r\n\r\n            this.internalValue = this.modelValue;\r\n\r\n            if (this.enhanceForLongLists) {\r\n                this.$nextTick(() => {\r\n                    const $chosenDropDown = this.getChosenJqueryEl();\r\n                    $chosenDropDown.trigger(\"chosen:updated\");\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    watch: {\r\n        modelValue: {\r\n            immediate: true,\r\n            handler() {\r\n                this.syncValue();\r\n            }\r\n        },\r\n\r\n        items: {\r\n            immediate: true,\r\n            handler() {\r\n                this.syncValue();\r\n            }\r\n        },\r\n\r\n        internalValue() {\r\n            this.$emit(\"update:modelValue\", this.internalValue);\r\n        },\r\n\r\n        enhanceForLongLists() {\r\n            this.createOrDestroyChosen();\r\n        }\r\n    },\r\n\r\n    mounted() {\r\n        this.isMounted = true;\r\n        this.createOrDestroyChosen();\r\n    },\r\n\r\n    template: `\r\n<RockFormField\r\n    :modelValue=\"internalValue\"\r\n    formGroupClasses=\"rock-drop-down-list\"\r\n    name=\"dropdownlist\">\r\n    <template #default=\"{uniqueId, field}\">\r\n        <div class=\"control-wrapper\">\r\n            <select :id=\"uniqueId\" class=\"form-control\" :class=\"compiledFormControlClasses\" v-bind=\"field\" v-model=\"internalValue\" ref=\"theSelect\" multiple>\r\n                <option v-if=\"showBlankItem\" :value=\"blankValue\"></option>\r\n                <option v-for=\"item in items\" :key=\"item.value\" :value=\"item.value\">{{item.text}}</option>\r\n            </select>\r\n        </div>\r\n    </template>\r\n</RockFormField>\r\n`\r\n});\r\n"],"names":["defineComponent","name","components","RockFormField","props","modelValue","type","Array","default","items","formControlClasses","String","enhanceForLongLists","Boolean","data","uniqueId","concat","newGuid","internalValue","isMounted","computed","compiledFormControlClasses","methods","getChosenJqueryEl","jquery","window","$chosenDropDown","$refs","length","createOrDestroyChosen","chosen","width","placeholder_text_multiple","placeholder_text_single","change","val","syncValue","every","v","i","$nextTick","trigger","watch","immediate","handler","$emit","mounted","template"],"mappings":"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"}