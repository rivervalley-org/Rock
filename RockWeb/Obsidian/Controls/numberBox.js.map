{"version":3,"file":"numberBox.js","sources":["../../../Framework/Controls/numberBox.ts"],"sourcesContent":["ï»¿// <copyright>\r\n// Copyright by the Spark Development Network\r\n//\r\n// Licensed under the Rock Community License (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n// http://www.rockrms.com/license\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n// </copyright>\r\n\r\nimport { computed, defineComponent, PropType, ref, watch } from \"vue\";\r\nimport { normalizeRules, rulesPropType, ValidationRule } from \"@Obsidian/ValidationRules\";\r\nimport { asFormattedString, toNumberOrNull } from \"@Obsidian/Utility/numberUtils\";\r\nimport RockFormField from \"./rockFormField\";\r\n\r\nexport default defineComponent({\r\n    name: \"NumberBox\",\r\n\r\n    components: {\r\n        RockFormField\r\n    },\r\n\r\n    props: {\r\n        modelValue: {\r\n            type: Number as PropType<number | null>,\r\n            default: null\r\n        },\r\n        placeholder: {\r\n            type: String as PropType<string>,\r\n            default: \"\"\r\n        },\r\n        /** The minimum allowed value to be entered. */\r\n        minimumValue: {\r\n            type: Number as PropType<number | null>\r\n        },\r\n        maximumValue: {\r\n            type: Number as PropType<number | null>\r\n        },\r\n        /** The number of decimal places allowed. */\r\n        decimalCount: {\r\n            type: Number as PropType<number | null>,\r\n            default: null\r\n        },\r\n        inputClasses: {\r\n            type: String as PropType<string>,\r\n            default: \"\"\r\n        },\r\n        inputGroupClasses: {\r\n            type: String as PropType<string>,\r\n            default: \"\"\r\n        },\r\n        rules: rulesPropType\r\n    },\r\n\r\n    emits: {\r\n        \"update:modelValue\": (_value: number | null) => true\r\n    },\r\n\r\n    setup(props, ctx) {\r\n        const internalValue = ref(asFormattedString(props.modelValue, props.decimalCount ?? undefined, { useGrouping: false }));\r\n\r\n        const internalNumberValue = computed((): number | null => {\r\n            return toNumberOrNull(internalValue.value);\r\n        });\r\n\r\n        const internalStep = computed((): string => {\r\n            return props.decimalCount === null ? \"any\" : (1 / Math.pow(10, props.decimalCount)).toString();\r\n        });\r\n\r\n        const isInputGroup = computed((): boolean => {\r\n            return !!ctx.slots.inputGroupPrepend || !!ctx.slots.inputGroupAppend;\r\n        });\r\n\r\n        const controlContainerClass = computed((): string => {\r\n            return isInputGroup.value ? `input-group ${props.inputGroupClasses}` : \"\";\r\n        });\r\n\r\n        const computedRules = computed((): ValidationRule[] => {\r\n            const rules = normalizeRules(props.rules);\r\n\r\n            if (props.maximumValue !== null && props.maximumValue !== undefined) {\r\n                rules.push(`lte:${props.maximumValue}`);\r\n            }\r\n\r\n            if (props.minimumValue !== null && props.minimumValue !== undefined) {\r\n                rules.push(`gte:${props.minimumValue}`);\r\n            }\r\n\r\n            return rules;\r\n        });\r\n\r\n        watch(() => props.modelValue, () => {\r\n            if (props.modelValue !== internalNumberValue.value) {\r\n                internalValue.value = asFormattedString(props.modelValue, props.decimalCount ?? undefined, { useGrouping: false });\r\n            }\r\n        });\r\n\r\n        watch(internalNumberValue, () => {\r\n            ctx.emit(\"update:modelValue\", internalNumberValue.value);\r\n        });\r\n\r\n        return {\r\n            computedRules,\r\n            controlContainerClass,\r\n            internalStep,\r\n            internalValue\r\n        };\r\n    },\r\n\r\n    template: `\r\n<RockFormField\r\n    :modelValue=\"internalValue\"\r\n    formGroupClasses=\"rock-number-box\"\r\n    name=\"numberbox\"\r\n    :rules=\"computedRules\">\r\n    <template #default=\"{uniqueId, field}\">\r\n        <div class=\"control-wrapper\">\r\n            <slot name=\"prepend\" />\r\n            <div :class=\"controlContainerClass\">\r\n                <slot name=\"inputGroupPrepend\" :isInputGroupSupported=\"true\" />\r\n                <input\r\n                    v-model=\"internalValue\"\r\n                    :id=\"uniqueId\"\r\n                    type=\"number\"\r\n                    class=\"form-control\"\r\n                    :class=\"inputClasses\"\r\n                    v-bind=\"field\"\r\n                    :placeholder=\"placeholder\"\r\n                    :step=\"internalStep\"\r\n                    :min=\"minimumValue\"\r\n                    :max=\"maximumValue\" />\r\n                <slot name=\"inputGroupAppend\" :isInputGroupSupported=\"true\" />\r\n            </div>\r\n            <slot name=\"append\" />\r\n        </div>\r\n    </template>\r\n</RockFormField>`\r\n});\r\n"],"names":["defineComponent","name","components","RockFormField","props","modelValue","type","Number","default","placeholder","String","minimumValue","maximumValue","decimalCount","inputClasses","inputGroupClasses","rules","rulesPropType","emits","_value","setup","ctx","_props$decimalCount","internalValue","ref","asFormattedString","undefined","useGrouping","internalNumberValue","computed","toNumberOrNull","value","internalStep","Math","pow","toString","isInputGroup","slots","inputGroupPrepend","inputGroupAppend","controlContainerClass","concat","computedRules","normalizeRules","push","watch","_props$decimalCount2","emit","template"],"mappings":"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"}