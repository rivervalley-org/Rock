{"version":3,"file":"locationAddressPicker.obs.js","sources":["../../../Framework/Controls/locationAddressPicker.obs"],"sourcesContent":["<!-- Copyright by the Spark Development Network; Licensed under the Rock Community License -->\r\n<template>\r\n    <ContentDropDownPicker\r\n                           v-bind=\"formFieldProps\"\r\n                           :modelValue=\"pickerValue\"\r\n                           iconCssClass=\"fa fa-map-marker\"\r\n                           :showClear=\"!!pickerValue\"\r\n                           @primaryButtonClicked=\"select\"\r\n                           @secondaryButtonClicked=\"cancel\"\r\n                           @clearButtonClicked=\"clear\"\r\n                           pickerContentBoxHeight=\"auto\"\r\n                           disablePickerContentBoxScroll\r\n                           disableAutoCloseOnPrimaryAction\r\n                           v-model:showPopup=\"showPopup\">\r\n\r\n        <template #innerLabel>\r\n            <span class=\"selected-names\" v-html=\"pickerLabel\"></span>\r\n        </template>\r\n\r\n        <RockValidation :errors=\"errors\" />\r\n        <AddressControl v-model=\"controlValue\" rules=\"required\" />\r\n\r\n        <template #primaryButtonLabel>\r\n            <Loading :isLoading=\"isLoading\">Select</Loading>\r\n        </template>\r\n\r\n        <template #pickerContentSuperHeader v-if=\"$slots.pickerContentSuperHeader\">\r\n            <slot name=\"pickerContentSuperHeader\" />\r\n        </template>\r\n        <template #prepend=\"{ isInputGroupSupported }\" v-if=\"$slots.prepend\">\r\n            <slot name=\"prepend\" :isInputGroupSupported=\"isInputGroupSupported\" />\r\n        </template>\r\n        <template #inputGroupPrepend=\"{ isInputGroupSupported }\" v-if=\"$slots.inputGroupPrepend\">\r\n            <slot name=\"inputGroupPrepend\" :isInputGroupSupported=\"isInputGroupSupported\" />\r\n        </template>\r\n        <template #append=\"{ isInputGroupSupported }\" v-if=\"$slots.append\">\r\n            <slot name=\"append\" :isInputGroupSupported=\"isInputGroupSupported\" />\r\n        </template>\r\n    </ContentDropDownPicker>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n    import { PropType, ref, watch } from \"vue\";\r\n    import { standardRockFormFieldProps, updateRefValue, useStandardRockFormFieldProps } from \"@Obsidian/Utility/component\";\r\n    import ContentDropDownPicker from \"./contentDropDownPicker.obs\";\r\n    import AddressControl from \"./addressControl.obs\";\r\n    import { AddressControlBag } from \"@Obsidian/ViewModels/Controls/addressControlBag\";\r\n    import { FormError } from \"@Obsidian/Utility/form\";\r\n    import RockValidation from \"./rockValidation\";\r\n    import { validateAddress } from \"@Obsidian/Utility/address\";\r\n    import Loading from \"./loading\";\r\n\r\n    const props = defineProps({\r\n        ...standardRockFormFieldProps,\r\n\r\n        modelValue: {\r\n            type: Object as PropType<AddressControlBag>,\r\n            required: true\r\n        }\r\n    });\r\n\r\n    const emit = defineEmits<{\r\n        (e: \"update:modelValue\", value: AddressControlBag): void\r\n    }>();\r\n\r\n    // #region Values\r\n\r\n    // Address Control\r\n    const controlValue = ref({ ...props.modelValue });\r\n\r\n    // This Picker\r\n    const pickerValue = ref({ ...props.modelValue });\r\n    const pickerLabel = ref(\"\");\r\n    const errors = ref<FormError[]>([]);\r\n    const isLoading = ref(false);\r\n    const showPopup = ref(false);\r\n\r\n    const formFieldProps = useStandardRockFormFieldProps(props);\r\n\r\n    // #endregion\r\n\r\n    // #region Event Handlers\r\n\r\n    async function select(): Promise<void> {\r\n        isLoading.value = true;\r\n        const response = await validateAddress({ ...controlValue.value });\r\n\r\n        if (response.isSuccess && response.data) {\r\n            if (response.data.isValid) {\r\n                errors.value = [];\r\n                pickerValue.value = { ...response.data.address } as AddressControlBag;\r\n                controlValue.value = { ...response.data.address } as AddressControlBag;\r\n                pickerLabel.value = response.data.addressString ?? \"\";\r\n                showPopup.value = false;\r\n            }\r\n            else {\r\n                errors.value = [{ name: \"Invalid\", text: response.data.errorMessage ?? \"Please enter a valid address.\" }];\r\n            }\r\n        }\r\n        else {\r\n            console.error(response.errorMessage ?? \"Unknown error while validating address.\");\r\n            errors.value = [{ name: \"Server\", text: response.errorMessage ?? \"An unknown error occurred. Please try again.\" }];\r\n        }\r\n        isLoading.value = false;\r\n    }\r\n\r\n    function cancel(): void {\r\n        // Reset the map values to the picker values when selection is cancelled\r\n        controlValue.value = pickerValue.value;\r\n    }\r\n\r\n    function clear(): void {\r\n        pickerValue.value = {};\r\n        pickerLabel.value = \"\";\r\n    }\r\n\r\n    // #endregion\r\n\r\n    // #region Watchers\r\n\r\n    watch(() => props.modelValue, () => {\r\n        updateRefValue(controlValue, { ...props.modelValue });\r\n        updateRefValue(pickerValue, { ...props.modelValue });\r\n    });\r\n\r\n    watch(pickerValue, () => {\r\n        emit(\"update:modelValue\", pickerValue.value);\r\n    });\r\n\r\n    // #endregion\r\n</script>\r\n"],"names":["controlValue","ref","_objectSpread","props","modelValue","pickerValue","pickerLabel","errors","isLoading","showPopup","formFieldProps","useStandardRockFormFieldProps","select","_select","apply","arguments","_asyncToGenerator","value","response","validateAddress","isSuccess","data","isValid","_response$data$addres","address","addressString","_response$data$errorM","name","text","errorMessage","_response$errorMessag","_response$errorMessag2","console","error","cancel","clear","watch","updateRefValue","emit"],"mappings":"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"}