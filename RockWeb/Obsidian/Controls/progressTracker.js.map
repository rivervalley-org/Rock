{"version":3,"file":"progressTracker.js","sources":["../../../Framework/Controls/progressTracker.ts"],"sourcesContent":["ï»¿// <copyright>\r\n// Copyright by the Spark Development Network\r\n//\r\n// Licensed under the Rock Community License (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n// http://www.rockrms.com/license\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n// </copyright>\r\n//\r\n\r\nimport { defineComponent, PropType } from \"vue\";\r\nimport { newGuid } from \"@Obsidian/Utility/guid\";\r\n\r\n/** The data needed to represent an item in a ProgressTracker */\r\nexport type ProgressTrackerItem = {\r\n    title: string;\r\n    subtitle: string;\r\n    key: string;\r\n};\r\n\r\nconst progressTrackerItem = defineComponent({\r\n    name: \"ProgressTrackerItem\",\r\n    props: {\r\n        isPast: {\r\n            type: Boolean as PropType<boolean>,\r\n            required: true\r\n        },\r\n        isPresent: {\r\n            type: Boolean as PropType<boolean>,\r\n            required: true\r\n        },\r\n        isFuture: {\r\n            type: Boolean as PropType<boolean>,\r\n            required: true\r\n        },\r\n        isLast: {\r\n            type: Boolean as PropType<boolean>,\r\n            required: true\r\n        },\r\n        item: {\r\n            type: Object as PropType<ProgressTrackerItem>,\r\n            required: true\r\n        }\r\n    },\r\n    template: `\r\n<li class=\"progress-step progress-tracker-priority\">\r\n    <div v-if=\"isPast\" class=\"progress-step-link\">\r\n        <div class=\"progress-tracker-icon\">\r\n            <i class=\"fas fa-check\"></i>\r\n        </div>\r\n        <div class=\"progress-tracker-details\">\r\n            <span class=\"progress-tracker-title text-truncate\">{{item.title}}</span>\r\n            <p class=\"progress-tracker-subtitle text-truncate\">{{item.subtitle}}</p>\r\n        </div>\r\n    </div>\r\n    <div v-else-if=\"isPresent\" class=\"progress-step-link\">\r\n        <div class=\"progress-tracker-icon current\"></div>\r\n        <div class=\"progress-tracker-details\">\r\n            <span class=\"progress-tracker-title text-truncate\">{{item.title}}</span>\r\n            <p class=\"progress-tracker-subtitle text-truncate\">{{item.subtitle}}</p>\r\n        </div>\r\n    </div>\r\n    <div v-else-if=\"isFuture\" class=\"progress-step-link\">\r\n        <div class=\"progress-tracker-icon upcoming\"></div>\r\n        <div class=\"progress-tracker-details\">\r\n            <span class=\"progress-tracker-title text-truncate\">{{item.title}}</span>\r\n            <p class=\"progress-tracker-subtitle text-truncate\">{{item.subtitle}}</p>\r\n        </div>\r\n    </div>\r\n    <div v-if=\"!isLast\" class=\"progress-tracker-arrow\">\r\n        <svg viewBox=\"0 0 22 80\" fill=\"none\" preserveAspectRatio=\"none\">\r\n            <path d=\"M0 -2L20 40L0 82\" vector-effect=\"non-scaling-stroke\" stroke=\"currentcolor\" stroke-linejoin=\"round\" />\r\n        </svg>\r\n    </div>\r\n</li>\r\n`\r\n});\r\n\r\n/** Displays a roadmap of successive steps that help the user understand where in a\r\n *  series of forms they currently are working. */\r\nconst ProgressTracker = defineComponent({\r\n    name: \"ProgressTracker\",\r\n    components: {\r\n        ProgressTrackerItem: progressTrackerItem\r\n    },\r\n    props: {\r\n        currentIndex: {\r\n            type: Number as PropType<number>,\r\n            required: true\r\n        },\r\n        items: {\r\n            type: Array as PropType<ProgressTrackerItem[]>,\r\n            required: true\r\n        }\r\n    },\r\n    data () {\r\n        return {\r\n            guid: newGuid(),\r\n            collapsedIndexes: [] as number[]\r\n        };\r\n    },\r\n    computed: {\r\n        /** Is the given index collapsed? */\r\n        isCollapsed (): (index: number) => boolean {\r\n            return (index: number) => this.collapsedIndexes.indexOf(index) !== -1;\r\n        },\r\n\r\n        /** A list of indexes that should not be collapsed. These are not guaranteed to be valid or unique\r\n         *  indexes, but rather a collection to check existance before collapsing a particular index. */\r\n        doNotCollapseIndexes (): number[] {\r\n            return [ 0, this.currentIndex - 1, this.currentIndex, this.currentIndex + 1, this.lastIndex ];\r\n        },\r\n\r\n        /** The last index of the items (prop) */\r\n        lastIndex (): number {\r\n            return this.items.length - 1;\r\n        },\r\n\r\n        /** The element id of the progress tracker (child) */\r\n        progressTrackerElementId (): string {\r\n            return `progress-tracker-${this.guid}`;\r\n        },\r\n\r\n        /** The element id of the progress tracker container (parent) */\r\n        progressTrackerContainerElementId (): string {\r\n            return `progress-tracker-container-${this.guid}`;\r\n        },\r\n    },\r\n    methods: {\r\n        /** Expand all items and then collapse some to fit if needed */\r\n        expandAndCollapseItemsBecauseOfWidth () {\r\n            this.collapsedIndexes = [];\r\n            this.$nextTick(() => this.collapseItemsBecauseOfWidth());\r\n        },\r\n\r\n        /** Collapse some items if needed to make fit */\r\n        collapseItemsBecauseOfWidth () {\r\n            // Using the DOM query getElementById because Vue refs were not conveying the changing width\r\n            const progressTracker = document.getElementById(this.progressTrackerElementId);\r\n            const progressTrackerContainer = document.getElementById(this.progressTrackerContainerElementId);\r\n\r\n            const containerWidth = progressTrackerContainer?.clientWidth;\r\n            const childWidth = progressTracker?.scrollWidth;\r\n\r\n            if (!containerWidth || !childWidth || childWidth <= containerWidth) {\r\n                return;\r\n            }\r\n\r\n            // Collapse the furthest away index that can be collapsed\r\n            const midPoint = this.lastIndex / 2;\r\n\r\n            if (this.currentIndex > midPoint) {\r\n                for (let i = 0; i <= this.lastIndex; i++) {\r\n                    if (this.doNotCollapseIndexes.indexOf(i) !== -1) {\r\n                        continue;\r\n                    }\r\n\r\n                    if (this.isCollapsed(i)) {\r\n                        continue;\r\n                    }\r\n\r\n                    // After collapsing the first index that can be, then wait for the DOM to update (nexttick) and\r\n                    // collapse more if needed\r\n                    this.collapsedIndexes.push(i);\r\n                    this.$nextTick(() => this.collapseItemsBecauseOfWidth());\r\n                    return;\r\n                }\r\n            }\r\n            else {\r\n                for (let i = this.lastIndex; i >= 0; i--) {\r\n                    if (this.doNotCollapseIndexes.indexOf(i) !== -1) {\r\n                        continue;\r\n                    }\r\n\r\n                    if (this.isCollapsed(i)) {\r\n                        continue;\r\n                    }\r\n\r\n                    // After collapsing the first index that can be, then wait for the DOM to update (nexttick) and\r\n                    // collapse more if needed\r\n                    this.collapsedIndexes.push(i);\r\n                    this.$nextTick(() => this.collapseItemsBecauseOfWidth());\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    },\r\n    watch: {\r\n        currentIndex: {\r\n            immediate: true,\r\n            handler () {\r\n                this.expandAndCollapseItemsBecauseOfWidth();\r\n            }\r\n        }\r\n    },\r\n    template: `\r\n<nav class=\"progress-tracker\" style=\"margin: 20px auto; max-width: 1200px; width:100%\">\r\n    <div :id=\"progressTrackerContainerElementId\" class=\"progress-tracker-container d-none d-md-block\">\r\n        <ul :id=\"progressTrackerElementId\" class=\"progress-steps\">\r\n            <template v-for=\"(item, index) in items\" :key=\"item.key\">\r\n                <li v-if=\"isCollapsed(index)\" class=\"progress-step progress-tracker-more\">\r\n                    <div class=\"progress-step-link\">\r\n                        <i class=\"fas fa-ellipsis-v\"></i>\r\n                    </div>\r\n                    <div class=\"progress-tracker-arrow\">\r\n                        <svg viewBox=\"0 0 22 80\" fill=\"none\" preserveAspectRatio=\"none\">\r\n                            <path d=\"M0 -2L20 40L0 82\" vector-effect=\"non-scaling-stroke\" stroke=\"currentcolor\" stroke-linejoin=\"round\" />\r\n                        </svg>\r\n                    </div>\r\n                </li>\r\n                <ProgressTrackerItem\r\n                    v-else\r\n                    :item=\"item\"\r\n                    :isPast=\"index < currentIndex\"\r\n                    :isPresent=\"index === currentIndex\"\r\n                    :isFuture=\"index > currentIndex\"\r\n                    :isLast=\"index === lastIndex\" />\r\n            </template>\r\n        </ul>\r\n    </div>\r\n    <slot name=\"aside\" />\r\n</nav>`\r\n});\r\n\r\nexport default ProgressTracker;\r\n"],"names":["progressTrackerItem","defineComponent","name","props","isPast","type","Boolean","required","isPresent","isFuture","isLast","item","Object","template","ProgressTracker","components","ProgressTrackerItem","currentIndex","Number","items","Array","data","guid","newGuid","collapsedIndexes","computed","isCollapsed","index","indexOf","doNotCollapseIndexes","lastIndex","length","progressTrackerElementId","concat","progressTrackerContainerElementId","methods","expandAndCollapseItemsBecauseOfWidth","$nextTick","collapseItemsBecauseOfWidth","progressTracker","document","getElementById","progressTrackerContainer","containerWidth","clientWidth","childWidth","scrollWidth","midPoint","i","push","watch","immediate","handler"],"mappings":"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"}