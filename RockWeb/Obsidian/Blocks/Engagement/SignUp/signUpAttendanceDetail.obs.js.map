{"version":3,"file":"signUpAttendanceDetail.obs.js","sources":["../../../src/Engagement/SignUp/signUpAttendanceDetail.obs"],"sourcesContent":["<!-- Copyright by the Spark Development Network; Licensed under the Rock Community License -->\r\n<template>\r\n    <NotificationBox v-if=\"blockErrorMessage\" alertType=\"warning\">\r\n        {{ blockErrorMessage }}\r\n    </NotificationBox>\r\n\r\n    <NotificationBox v-if=\"errorMessage\" alertType=\"warning\">\r\n        {{ errorMessage }}\r\n    </NotificationBox>\r\n\r\n    <NotificationBox v-if=\"successMessage\" alertType=\"success\">\r\n        {{ successMessage }}\r\n    </NotificationBox>\r\n\r\n    <div v-if=\"shouldShowAttendanceForm\">\r\n        <div ref=\"headerElement\"></div>\r\n        <RockForm @submit=\"onSubmit\">\r\n            <CheckboxList v-model=\"selectedAttendees\" label=\"Attendees\" :items=\"attendees\" @update:modelValue=\"onAttendeesUpdated\" />\r\n\r\n            <div class=\"actions\">\r\n                <RockButton type=\"submit\" :btnType=\"BtnType.Primary\" :disabled=\"isSaving\">Save</RockButton>\r\n            </div>\r\n        </RockForm>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n    import { computed, onMounted, ref } from \"vue\";\r\n    import NotificationBox from \"@Obsidian/Controls/notificationBox.obs\";\r\n    import CheckboxList from \"@Obsidian/Controls/checkBoxList\";\r\n    import RockButton from \"@Obsidian/Controls/rockButton\";\r\n    import RockForm from \"@Obsidian/Controls/rockForm\";\r\n    import { BtnType } from \"@Obsidian/Enums/Controls/btnType\";\r\n    import { HttpResult } from \"@Obsidian/Types/Utility/http\";\r\n    import { useConfigurationValues, useReloadBlock, onConfigurationValuesChanged, useInvokeBlockAction } from \"@Obsidian/Utility/block\";\r\n    import { SignUpAttendanceBag } from \"@Obsidian/ViewModels/Blocks/Engagement/SignUp/SignUpAttendanceDetail/signUpAttendanceBag\";\r\n    import { SignUpAttendanceDetailInitializationBox } from \"@Obsidian/ViewModels/Blocks/Engagement/SignUp/SignUpAttendanceDetail/signUpAttendanceDetailInitializationBox\";\r\n    import { SignUpAttendeeBag } from \"@Obsidian/ViewModels/Blocks/Engagement/SignUp/SignUpAttendanceDetail/signUpAttendeeBag\";\r\n    import { ListItemBag } from \"@Obsidian/ViewModels/Utility/listItemBag\";\r\n\r\n    const config = useConfigurationValues<SignUpAttendanceDetailInitializationBox>();\r\n    const invokeBlockAction = useInvokeBlockAction();\r\n\r\n    // #region Values\r\n\r\n    const headerElement = ref<HTMLElement | null>(null);\r\n    const selectedAttendees = ref<string[]>([]);\r\n\r\n    const errorMessage = ref(\"\");\r\n    const successMessage = ref(\"\");\r\n    const isSaving = ref(false);\r\n\r\n    // #endregion\r\n\r\n    // #region Computed Values\r\n\r\n    const blockErrorMessage = computed((): string | undefined | null => {\r\n        return config.errorMessage;\r\n    });\r\n\r\n    const attendees = computed((): ListItemBag[] => {\r\n        var listItemBag: ListItemBag[] = config.attendees?.map(a => ({\r\n            text: a.name,\r\n            value: a.personAliasId.toString()\r\n        })) ?? [];\r\n\r\n        return listItemBag;\r\n    });\r\n\r\n    const shouldShowAttendanceForm = computed((): boolean => {\r\n        if (blockErrorMessage.value) {\r\n            return false;\r\n        }\r\n\r\n        return !successMessage.value;\r\n    });\r\n\r\n    // #endregion\r\n\r\n    // #region Event Handlers\r\n\r\n    /**\r\n     * Handles the `update:modelValue` event of the Attendees `CheckBoxList`.\r\n     */\r\n    function onAttendeesUpdated(): void {\r\n        if (!config.attendees?.length) {\r\n            return;\r\n        }\r\n\r\n        config.attendees.forEach((a: SignUpAttendeeBag) => a.didAttend = selectedAttendees.value.includes(a.personAliasId.toString()));\r\n    }\r\n\r\n    /**\r\n     * Handles the form submission.\r\n     */\r\n    async function onSubmit(): Promise<void> {\r\n        isSaving.value = true;\r\n        errorMessage.value = \"\";\r\n        successMessage.value = \"\";\r\n\r\n        const bag: SignUpAttendanceBag = {\r\n            attendees: config.attendees\r\n        };\r\n\r\n        const result: HttpResult<void> = await invokeBlockAction(\"SaveAttendance\", { bag });\r\n        isSaving.value = false;\r\n\r\n        if (!result.isSuccess) {\r\n            errorMessage.value = result.errorMessage ?? \"Unknown error when trying to enter attendance.\";\r\n            return;\r\n        }\r\n\r\n        successMessage.value = \"Successfully entered attendance.\";\r\n    }\r\n\r\n    // #endregion\r\n\r\n    onConfigurationValuesChanged(useReloadBlock());\r\n\r\n    if (config.attendees?.length) {\r\n        config.attendees\r\n            .filter((a: SignUpAttendeeBag) => a.didAttend)\r\n            .forEach((a: SignUpAttendeeBag) => selectedAttendees.value.push(a.personAliasId.toString()));\r\n    }\r\n\r\n    onMounted(() => {\r\n        if (headerElement.value && config.headerHtml) {\r\n            headerElement.value.innerHTML = config.headerHtml;\r\n        }\r\n    });\r\n</script>\r\n"],"names":["config","useConfigurationValues","invokeBlockAction","useInvokeBlockAction","headerElement","ref","selectedAttendees","errorMessage","successMessage","isSaving","blockErrorMessage","computed","attendees","_config$attendees$map","_config$attendees","listItemBag","map","a","text","name","value","personAliasId","toString","shouldShowAttendanceForm","onAttendeesUpdated","_config$attendees2","length","forEach","didAttend","includes","onSubmit","_onSubmit","apply","arguments","_asyncToGenerator","bag","result","isSuccess","_result$errorMessage","onConfigurationValuesChanged","useReloadBlock","_config$attendees3","filter","push","onMounted","headerHtml","innerHTML"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAwCI,IAAMA,MAAM,GAAGC,sBAAsB,EAA2C,CAAA;UAChF,IAAMC,iBAAiB,GAAGC,oBAAoB,EAAE,CAAA;MAIhD,IAAA,IAAMC,aAAa,GAAGC,GAAG,CAAqB,IAAI,CAAC,CAAA;MACnD,IAAA,IAAMC,iBAAiB,GAAGD,GAAG,CAAW,EAAE,CAAC,CAAA;MAE3C,IAAA,IAAME,YAAY,GAAGF,GAAG,CAAC,EAAE,CAAC,CAAA;MAC5B,IAAA,IAAMG,cAAc,GAAGH,GAAG,CAAC,EAAE,CAAC,CAAA;MAC9B,IAAA,IAAMI,QAAQ,GAAGJ,GAAG,CAAC,KAAK,CAAC,CAAA;MAM3B,IAAA,IAAMK,iBAAiB,GAAGC,QAAQ,CAAC,MAAiC;YAChE,OAAOX,MAAM,CAACO,YAAY,CAAA;MAC9B,KAAC,CAAC,CAAA;MAEF,IAAA,IAAMK,SAAS,GAAGD,QAAQ,CAAC,MAAqB;YAAA,IAAAE,qBAAA,EAAAC,iBAAA,CAAA;MAC5C,MAAA,IAAIC,WAA0B,GAAAF,CAAAA,qBAAA,GAAAC,CAAAA,iBAAA,GAAGd,MAAM,CAACY,SAAS,MAAA,IAAA,IAAAE,iBAAA,KAAhBA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,iBAAA,CAAkBE,GAAG,CAACC,CAAC,KAAK;cACzDC,IAAI,EAAED,CAAC,CAACE,IAAI;MACZC,QAAAA,KAAK,EAAEH,CAAC,CAACI,aAAa,CAACC,QAAQ,EAAA;MACnC,OAAC,CAAC,CAAC,MAAA,IAAA,IAAAT,qBAAA,KAAAA,KAAAA,CAAAA,GAAAA,qBAAA,GAAI,EAAE,CAAA;MAET,MAAA,OAAOE,WAAW,CAAA;MACtB,KAAC,CAAC,CAAA;MAEF,IAAA,IAAMQ,wBAAwB,GAAGZ,QAAQ,CAAC,MAAe;YACrD,IAAID,iBAAiB,CAACU,KAAK,EAAE;MACzB,QAAA,OAAO,KAAK,CAAA;MAChB,OAAA;YAEA,OAAO,CAACZ,cAAc,CAACY,KAAK,CAAA;MAChC,KAAC,CAAC,CAAA;UASF,SAASI,kBAAkBA,GAAS;MAAA,MAAA,IAAAC,kBAAA,CAAA;MAChC,MAAA,IAAI,EAAAA,CAAAA,kBAAA,GAACzB,MAAM,CAACY,SAAS,MAAAa,IAAAA,IAAAA,kBAAA,KAAhBA,KAAAA,CAAAA,IAAAA,kBAAA,CAAkBC,MAAM,CAAE,EAAA;MAC3B,QAAA,OAAA;MACJ,OAAA;YAEA1B,MAAM,CAACY,SAAS,CAACe,OAAO,CAAEV,CAAoB,IAAKA,CAAC,CAACW,SAAS,GAAGtB,iBAAiB,CAACc,KAAK,CAACS,QAAQ,CAACZ,CAAC,CAACI,aAAa,CAACC,QAAQ,EAAE,CAAC,CAAC,CAAA;MAClI,KAAA;MAAC,IAAA,SAKcQ,QAAQA,GAAA;MAAA,MAAA,OAAAC,SAAA,CAAAC,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,CAAA;MAAA,KAAA;MAAA,IAAA,SAAAF,SAAA,GAAA;YAAAA,SAAA,GAAAG,iBAAA,CAAvB,aAAyC;cACrCzB,QAAQ,CAACW,KAAK,GAAG,IAAI,CAAA;cACrBb,YAAY,CAACa,KAAK,GAAG,EAAE,CAAA;cACvBZ,cAAc,CAACY,KAAK,GAAG,EAAE,CAAA;MAEzB,QAAA,IAAMe,GAAwB,GAAG;gBAC7BvB,SAAS,EAAEZ,MAAM,CAACY,SAAAA;eACrB,CAAA;MAED,QAAA,IAAMwB,MAAwB,GAAA,MAASlC,iBAAiB,CAAC,gBAAgB,EAAE;MAAEiC,UAAAA,GAAAA;MAAI,SAAC,CAAC,CAAA;cACnF1B,QAAQ,CAACW,KAAK,GAAG,KAAK,CAAA;MAEtB,QAAA,IAAI,CAACgB,MAAM,CAACC,SAAS,EAAE;MAAA,UAAA,IAAAC,oBAAA,CAAA;MACnB/B,UAAAA,YAAY,CAACa,KAAK,GAAAkB,CAAAA,oBAAA,GAAGF,MAAM,CAAC7B,YAAY,MAAA+B,IAAAA,IAAAA,oBAAA,KAAAA,KAAAA,CAAAA,GAAAA,oBAAA,GAAI,gDAAgD,CAAA;MAC5F,UAAA,OAAA;MACJ,SAAA;cAEA9B,cAAc,CAACY,KAAK,GAAG,kCAAkC,CAAA;aAC5D,CAAA,CAAA;MAAA,MAAA,OAAAW,SAAA,CAAAC,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,CAAA;MAAA,KAAA;UAIDM,4BAA4B,CAACC,cAAc,EAAE,CAAC,CAAA;UAE9C,IAAAC,CAAAA,kBAAA,GAAIzC,MAAM,CAACY,SAAS,MAAA6B,IAAAA,IAAAA,kBAAA,KAAhBA,KAAAA,CAAAA,IAAAA,kBAAA,CAAkBf,MAAM,EAAE;MAC1B1B,MAAAA,MAAM,CAACY,SAAS,CACX8B,MAAM,CAAEzB,CAAoB,IAAKA,CAAC,CAACW,SAAS,CAAC,CAC7CD,OAAO,CAAEV,CAAoB,IAAKX,iBAAiB,CAACc,KAAK,CAACuB,IAAI,CAAC1B,CAAC,CAACI,aAAa,CAACC,QAAQ,EAAE,CAAC,CAAC,CAAA;MACpG,KAAA;MAEAsB,IAAAA,SAAS,CAAC,MAAM;MACZ,MAAA,IAAIxC,aAAa,CAACgB,KAAK,IAAIpB,MAAM,CAAC6C,UAAU,EAAE;MAC1CzC,QAAAA,aAAa,CAACgB,KAAK,CAAC0B,SAAS,GAAG9C,MAAM,CAAC6C,UAAU,CAAA;MACrD,OAAA;MACJ,KAAC,CAAC,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}